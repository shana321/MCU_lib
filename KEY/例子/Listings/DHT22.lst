C51 COMPILER V9.54   DHT22                                                                 02/23/2018 16:30:28 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE DHT22
OBJECT MODULE PLACED IN .\Objects\DHT22.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE DHT22.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\DHT
                    -22.lst) TABS(2) OBJECT(.\Objects\DHT22.obj)

line level    source

   1          #include "dht11.h"
*** WARNING C318 IN LINE 1 OF DHT22.c: can't open file 'dht11.h'
   2          
   3          void dht11_Init(dht11_t *dht,dht11_msg_cb dht_cb)
*** ERROR C141 IN LINE 3 OF DHT22.c: syntax error near '*', expected ')'
   4          {
   5   1        dht->gpio_and_delay_cb = dht_cb;
*** ERROR C202 IN LINE 5 OF DHT22.c: 'dht': undefined identifier
   6   1        dht->gpio_and_delay_cb(dht,dht11_MSG_SDA_HIGH);
*** ERROR C202 IN LINE 6 OF DHT22.c: 'dht': undefined identifier
   7   1        dht->gpio_and_delay_cb(dht,dht11_MSG_2S_DELAY);//保证上电2S越过dht11不稳定状态
*** ERROR C202 IN LINE 7 OF DHT22.c: 'dht': undefined identifier
   8   1      }
   9          uint8_t dht11_Read(dht11_t *dht)
*** ERROR C129 IN LINE 9 OF DHT22.c: missing ';' before 'dht11_Read'
  10          {
  11            uint8_t i,j,sum;
  12            dht->dht11_RXD_Buff[0] = dht->dht11_RXD_Buff[1] = dht->dht11_RXD_Buff[2] = dht->dht11_RXD_Buff[3] = dht->
             -dht11_RXD_Buff[4] = 0;
  13            dht->gpio_and_delay_cb(dht,dht11_MSG_SDA_HIGH);//拉高总线
  14            dht->gpio_and_delay_cb(dht,dht11_MSG_1MS_DELAY);//延时1ms
  15            dht->gpio_and_delay_cb(dht,dht11_MSG_SDA_LOW);//拉低
  16            
  17            dht->gpio_and_delay_cb(dht,dht11_MSG_18MS_DELAY);//延时18ms
  18          
  19            
  20            dht->gpio_and_delay_cb(dht,dht11_MSG_SDA_HIGH);//然后拉高
  21            dht->gpio_and_delay_cb(dht,dht11_MSG_30US_DELAY);//等待30us
  22              //做完一个起始信号，等待从机拉低
  23            if(dht->gpio_and_delay_cb(dht,dht11_MSG_READ_SDA) == 0)//读到的是低电平，从机响应了，那么等待其变高后准备
             -接收数据
  24            {
  25              while(!dht->gpio_and_delay_cb(dht,dht11_MSG_READ_SDA));//等待低电平结束
  26            }
  27            else
  28            {
  29              return 1;//直接返回，避免下面等待高电平陷入死循环
  30            }
  31            while(dht->gpio_and_delay_cb(dht,dht11_MSG_READ_SDA));//等待80us的高电平结束，然后开始接收
  32            
  33            for(j=0;j<5;j++)
  34            {
  35              for(i=0;i<8;i++)
  36              {
  37                while(!dht->gpio_and_delay_cb(dht,dht11_MSG_READ_SDA));//等待50us左右的低电平结束
  38                dht->dht11_RXD_Buff[j] <<=1;
  39                dht->gpio_and_delay_cb(dht,dht11_MSG_30US_DELAY);//延时1ms
  40                if(dht->gpio_and_delay_cb(dht,dht11_MSG_READ_SDA))
  41                {
  42                  dht->dht11_RXD_Buff[j] |= 0x01;
  43                  while(dht->gpio_and_delay_cb(dht,dht11_MSG_READ_SDA));//等待高电平结束
  44                }
  45              }
  46            }
C51 COMPILER V9.54   DHT22                                                                 02/23/2018 16:30:28 PAGE 2   

  47            
  48            sum = dht->dht11_RXD_Buff[0] + dht->dht11_RXD_Buff[1] + dht->dht11_RXD_Buff[2] + dht->dht11_RXD_Buff[3];
  49            
  50            if(sum != dht->dht11_RXD_Buff[4] || sum == 0) return 1;//检查校验和
  51            
  52            return 0;
  53          }
  54          uint8_t DHT11_Fget(dht11_t *dht,float *Humi,float *Temp)
  55          {
  56            
  57            uint16_t t = 0x0000;
  58            uint8_t sum = 0;
  59            sum = dht->dht11_RXD_Buff[0] + dht->dht11_RXD_Buff[1] + dht->dht11_RXD_Buff[2] + dht->dht11_RXD_Buff[3];
  60            
  61            if(sum != dht->dht11_RXD_Buff[4] || sum == 0) return 1;//检查校验和
  62            t |= dht->dht11_RXD_Buff[0];
  63            
  64            *Humi = (float)t;
  65            
  66            t = 0x0000;
  67            
  68            t = dht->dht11_RXD_Buff[2];
  69          
  70            *Temp = (float)t;
  71            return 0;
  72          }
  73          uint8_t DHT11_Iget(dht11_t *dht,int16_t *Humi,int16_t *Temp)
  74          {
  75            
  76            int16_t t = 0x0000;
  77            uint8_t sum = 0;
  78            sum = dht->dht11_RXD_Buff[0] + dht->dht11_RXD_Buff[1] + dht->dht11_RXD_Buff[2] + dht->dht11_RXD_Buff[3];
  79            
  80            if(sum != dht->dht11_RXD_Buff[4] || sum == 0) return 1;//检查校验和
  81            
  82            t |= dht->dht11_RXD_Buff[0];
  83            //t <<= 8;
  84            //t |= dht->dht11_RXD_Buff[1];
  85            
  86            *Humi = (int16_t)t;
  87            
  88            t = 0x0000;
  89            
  90            t = dht->dht11_RXD_Buff[2];
  91          
  92          
  93            *Temp = (int16_t)t;
  94            return 0;
  95          }

C51 COMPILATION COMPLETE.  1 WARNING(S),  5 ERROR(S)
